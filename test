#!/bin/bash

RED="\e[31m"
GREEN="\e[32m"
BLUE="\e[94m"
NORMAL="\e[0;39m"

OK=0
FAILED=0

echo -e ${BLUE}"-------------------"${NORMAL}
echo -e ${BLUE}"Running retina/test"${NORMAL}
echo -e ${BLUE}"-------------------"${NORMAL}
echo -e ""

export prolog="${1:-tpl}"
export retina=`pwd`/retina.pl
for dir in rdfsurfaces/*
do
    pushd "${dir}" > /dev/null
    ./test
    if [[ $(git status -s . | wc -l) -ne 0 ]]; then
        echo -e "${RED}FAILED${NORMAL}"
        ((FAILED++))
    else
        echo -e "${GREEN}OK${NORMAL}"
        ((OK++))
    fi
    popd > /dev/null
    echo ""
done

echo -e "Tests: ${GREEN}${OK} OK${NORMAL} ${RED}${FAILED} FAILED${NORMAL}"

if [[ ${FAILED} -eq 0 ]]; then
    exit 0
else
    exit 2
fi
